<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üè† House of the Day!</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { margin-bottom: 20px; }
    .card {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .left, .right { flex: 1; }
    .left { order: 2; }
    .right { order: 1; }
    .left {
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: left;
    }
    .property-info {
      font-size: 14px;
      color: #333;
      margin: 10px 0;
      display: none;
      background: #fff3cd;
      border-radius: 8px;
      padding: 10px;
      border: 1px solid #ffeeba;
    }
    img {
      border-radius: 10px;
      max-width: 100%;
      height: auto;
    }

    /* Spinner styles */
    .btn {
      box-shadow: 0 2px 5px 0 rgba(0,0,0,.16), 0 2px 10px 0 rgba(0,0,0,.12);
      border-radius: 0;
      z-index: 200;
      font-size: 38px;
      padding: 0 12px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn:focus, .btn:active, input:focus {
      box-shadow: 0 2px 5px 0 rgba(0,0,0,.16), 0 2px 10px 0 rgba(0,0,0,.12) !important;
      outline: none;
    }
    .btn-decrement {
      border-bottom-left-radius: 50%;
      border-top-left-radius: 50%;
      border: none;
    }
    .btn-increment {
      border-bottom-right-radius: 50%;
      border-top-right-radius: 50%;
      border: none;
    }
    .spinner-control {
      display: flex;
      width: 250px;
      margin: 0 auto 10px auto;
    }
    .spinner-control input {
      border: none;
      background-color: #007bff;
      color: #fff;
      text-align: center;
      z-index: 100;
      width: 100%;
      box-shadow: 0 2px 5px 0 rgba(0,0,0,.16), 0 2px 10px 0 rgba(0,0,0,.12);
      cursor: default;
      font-size: 16px;
    }
    .form-spinner label {
      width: 100%;
      text-align: center;
    }

    button.primary { background: #4CAF50; color: white; }
    button.secondary { background: #eee; color: #333; }
    button.secondary.active { background: #4CAF50; color: white; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .result {
      background: #f0f0f0;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
      /* Game buttons (renamed to avoid conflict with spinner buttons) */

      .button-group {
  display: flex;
  justify-content: center; /* centers horizontally */
  gap: 10px;               /* space between buttons */
  margin-top: 10px;        /* optional spacing above */
}

.game-btn {
  padding: 10px 16px;
  margin: 5px 5px 5px 0;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s ease;
}
.game-btn-primary { background: #4CAF50; color: white; }
.game-btn-secondary { background: #eee; color: #333; }
.game-btn-secondary.active { background: #4CAF50; color: white; }
.game-btn:disabled { background: #ccc; cursor: not-allowed; }

    @media screen and (min-width: 768px) {
      .card { flex-direction: row; align-items: flex-start; }
      .left { order: 1; }
      .right { order: 2; }
    }
  </style>
</head>
<body>
  <h1>üè† House of the Day!</h1>
  <div class="card">
    <div class="left">
      <p id="prompt"></p>
      <p id="propertyInfo" class="property-info"></p>
      
      <div class="form-spinner">
        <div class="spinner-control">
          <button type="button" class="btn btn-decrement">-</button>
          <input id="guessInput" type="number" value="500000" min="0" placeholder="Enter your guess ($)">
          <button type="button" class="btn btn-increment">+</button>
        </div>
      </div>

      <div>
        <div class="button-group">
  <button id="submitBtn" class="game-btn game-btn-primary" onclick="checkGuess()">Submit Guess</button>
  <button id="newPropertyBtn" class="game-btn game-btn-secondary" onclick="newRound()" disabled>New Property</button>
</div>
      </div>
      <div id="result" class="result" style="display: none;"></div>
    </div>
    <div class="right" id="image-container">
      <p>Loading property...</p>
    </div>
  </div>

<script>
  const THRESHOLD = 75;
  let properties = [];
  let current = null;
  let currentIndex = 0;
  let attempts = 0;

  const submitBtn = document.getElementById("submitBtn");
  const newPropertyBtn = document.getElementById("newPropertyBtn");
  const resultDiv = document.getElementById("result");
  const propInfoEl = document.getElementById("propertyInfo");
  const promptEl = document.getElementById("prompt");
  const imageContainer = document.getElementById("image-container");
  const guessInput = document.getElementById("guessInput");

  const lowComments = [
    c => `That‚Äôs a bargain for ${c.city}! This place costs way more.`,
    c => `Nice try, but you won‚Äôt find prices that low in ${c.city} since 1995.`,
    c => `This isn‚Äôt a yard sale in ${c.city} ‚Äî aim higher!`,
    c => `Dreaming of 2008 prices? Nope, it‚Äôs pricier in ${c.city} these days.`,
    c => `For that price you‚Äôd be buying just the doormat in ${c.city}!`
  ];
  const highComments = [
    c => `Woah there buddy ‚Äî this is ${c.city}, not Bel Air!`,
    c => `At that price they‚Äôd throw in a free yacht‚Ä¶ keep guessing!`,
    c => `Slow down, Jeff Bezos ‚Äî it‚Äôs not that expensive.`,
    c => `At that price you could buy half of ${c.city}!`,
    c => `This isn‚Äôt a private island ‚Äî dial it back.`,
    c => `Even in ${c.city}, that‚Äôs a bit rich!`
  ];
  function randomComment(isLow) {
    const list = isLow ? lowComments : highComments;
    const fn = list[Math.floor(Math.random() * list.length)];
    return fn(current);
  }

  async function loadData() {
    const res = await fetch("https://api.tripgeo.com/api/rentcast");
    const data = await res.json();
    properties = data;
    currentIndex = 0;
    newRound();
  }

  function formatHints(prop) {
    const hints = [
      prop.yearBuilt ? `Built in ${prop.yearBuilt}` : null,
      prop.bedrooms ? `${prop.bedrooms} bed` : null,
      prop.bathrooms ? `${prop.bathrooms} bath` : null,
      prop.squareFootage ? `${prop.squareFootage.toLocaleString()} sqft` : null,
      prop.lotSize ? `Lot: ${prop.lotSize.toLocaleString()} sqft` : null
    ].filter(Boolean).join(", ");
    return hints;
  }

  function getNextProperty() {
  if (currentIndex === 0) {
    // First property: always the first in the feed
    currentIndex++;
    return properties[0];
  }

  // Randomly pick a property after the first
  let property = null;
  let attempts = 0;
  const maxAttempts = properties.length * 2; // avoid infinite loop

  while (!property && attempts < maxAttempts) {
    const idx = Math.floor(Math.random() * properties.length);
    const candidate = properties[idx];

    if (
      candidate.streetView &&
      candidate.streetView.panoId &&
      candidate.streetView.panoId !== "null"
    ) {
      property = candidate;
    }
    attempts++;
  }

  return property;
}

  function newRound() {
    resultDiv.style.display = "none";
    propInfoEl.style.display = "none";
    propInfoEl.textContent = "";
    guessInput.value = "500000";
    attempts = 0;

    submitBtn.disabled = false;
    submitBtn.classList.add("primary");
    newPropertyBtn.disabled = true;
    newPropertyBtn.classList.remove("active");

    if (!properties || properties.length === 0) {
      promptEl.textContent = "No properties loaded.";
      imageContainer.innerHTML =
        `<div style="height:300px;display:flex;align-items:center;justify-content:center;background:#eee;border-radius:10px;">No properties available</div>`;
      return;
    }

    current = getNextProperty();
    if (!current) {
      promptEl.textContent = "No valid properties with Street View.";
      imageContainer.innerHTML =
        `<div style="height:300px;display:flex;align-items:center;justify-content:center;background:#eee;border-radius:10px;">No valid properties</div>`;
      return;
    }

    promptEl.textContent = `Guess the listing price for this property in ${current.city}, ${current.state}`;

    if (current.streetView && current.streetView.panoId) {
      const panoId = current.streetView.panoId;
      const direction = current.streetView.direction ?? 0;
      const lat = current.streetView.panoramaLat;
      const lng = current.streetView.panoramaLng;
      const gmapsUrl = `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat},${lng}&heading=${direction}`;
      const url = `https://api.tripgeo.com/api/StreetViewImage/${panoId}_${direction}`;
      imageContainer.innerHTML = `
        <a href="${gmapsUrl}" target="_blank" title="Click to view in Google Maps" style="text-decoration:none;">
          <img src="${url}" alt="Street View" style="cursor:pointer;border-radius:10px;max-width:100%;height:auto;" />
        </a>
        <p style="font-size:12px;color:#666;margin-top:5px;">Street View imagery ¬© Google 2025</p>`;
    } else {
      imageContainer.innerHTML =
        `<div style="height:300px;display:flex;align-items:center;justify-content:center;background:#eee;border-radius:10px;">
           No Street View Available
         </div>`;
    }

    current._hints = formatHints(current);
  }

function checkGuess() {
  const guess = parseInt(guessInput.value, 10);
  if (!current || isNaN(guess)) return;

  attempts++;
  propInfoEl.style.display = "none";

  const actual = current.price;

  // Calculate accuracy first
  let accuracy = actual > 0 ? Math.max(0, (1 - Math.abs(actual - guess) / actual) * 100) : (guess === actual ? 100 : 0);
  accuracy = Number(accuracy.toFixed(1));

  // Check if guess is within threshold
  if (accuracy >= THRESHOLD) {
    resultDiv.innerHTML = `
      <p><b>Actual Price:</b> $${actual.toLocaleString()}</p>
      <p><b>Accuracy:</b> ${accuracy}%</p>
      <p>üéâ Well done! It took you <b>${attempts}</b> attempt${attempts > 1 ? "s" : ""} to get within ${THRESHOLD}% of the price.</p>`;
    propInfoEl.style.display = "none";
    newPropertyBtn.disabled = false;
    newPropertyBtn.classList.add("active");
    submitBtn.disabled = true;
    submitBtn.classList.remove("primary");
    resultDiv.style.display = "block";
    return;
  }

  // If not correct, show funny/hint messages based on attempt
  const isLow = guess < actual;
  const funny = randomComment(isLow);
  const highLow = guess > actual ? "üí∞ The actual price is lower than your guess." : "üí∞ The actual price is higher than your guess.";

  if (attempts === 1) {
    const tip = `üó∫Ô∏è You can click the Street View image to explore the neighborhood.`;
    resultDiv.innerHTML = `<p>${funny}</p><p>${tip}</p>`;
  } else if (attempts === 2) {
    resultDiv.innerHTML = `<p>${funny}</p><p>${highLow}</p>`;
    propInfoEl.innerHTML = `<b>Still way off.</b> Here are some clues: ${current._hints}`;
    propInfoEl.style.display = "block";
  } else {
    resultDiv.innerHTML = `<p>${funny}</p><p><b>Accuracy:</b> ${accuracy}%</p><p>${highLow}</p>`;
    propInfoEl.innerHTML = `<b>Still way off.</b> Here are some clues: ${current._hints}`;
    propInfoEl.style.display = "block";
  }

  resultDiv.style.display = "block";
}


const incrementBtn = document.querySelector(".btn-increment");
const decrementBtn = document.querySelector(".btn-decrement");

function getStep(value) {
  if (value < 50000) return 1000;         // small values
  if (value < 500000) return 10000;       // medium values
  return 50000;                            // 500k and above
}

incrementBtn.addEventListener("click", () => {
  let val = parseInt(guessInput.value) || 0;
  const step = getStep(val);
  guessInput.value = val + step;
});

decrementBtn.addEventListener("click", () => {
  let val = parseInt(guessInput.value) || 0;
  const step = getStep(val);
  guessInput.value = Math.max(0, val - step);
});

  loadData();
</script>
</body>
</html>
